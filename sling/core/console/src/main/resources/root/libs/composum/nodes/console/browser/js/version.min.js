var $jscomp={scope:{},findInternal:function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(c.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
(function(a){a.browser=a.browser||{};(function(c){c.getAddLabelDialog=function(){return a.getView("#version-add-label-dialog",c.AddLabelDialog)};c.getDeleteLabelDialog=function(){return a.getView("#version-delete-label-dialog",c.DeleteLabelDialog)};c.getDeleteVersionDialog=function(){return a.getView("#version-delete-dialog",c.DeleteVersionDialog)};c.DeleteVersionDialog=a.components.Dialog.extend({initialize:function(b){a.components.Dialog.prototype.initialize.apply(this,[b]);this.form=a.getWidget(this.el,
"form.widget-form",a.components.FormWidget);this.name=a.getWidget(this.el,'input[name="name"]',a.components.TextFieldWidget);this.$("button.delete").click(_.bind(this.deleteVersion,this));this.$el.on("shown.bs.modal",function(){$(this).find('input[name="name"]').focus()});c.getCurrentPath()},setVersion:function(a){this.name.setValue(a)},deleteVersion:function(b){b.preventDefault();b=c.getCurrentPath();var d=this.name.getValue();a.ajaxDelete("/bin/cpm/nodes/version.version.json"+b,{data:JSON.stringify({version:d,
path:b})},_.bind(function(a){this.hide()},this),_.bind(function(a){this.alert("danger","Error on deleting version",a)},this));return!1}});c.DeleteLabelDialog=a.components.Dialog.extend({initialize:function(b){a.components.Dialog.prototype.initialize.apply(this,[b]);this.$form=a.getWidget(this.el,"form.widget-form",a.components.FormWidget);this.labelname=a.getWidget(this.el,'input[name="labelname"]',a.components.TextFieldWidget);this.$("button.delete").click(_.bind(this.deleteLabel,this));this.$el.on("shown.bs.modal",
function(){$(this).find('input[name="labelname"]').focus()});this.labelname.$el.attr("autocomplete","off");var d=c.getCurrentPath();this.labelname.$el.typeahead({minLength:1,source:function(b,c){a.getJson("/bin/cpm/nodes/version.labels.json"+d+"?label="+b,function(a){c(a)})}})},deleteLabel:function(b){b.preventDefault();b=c.getCurrentPath();var d=this.labelname.getValue();a.ajaxDelete("/bin/cpm/nodes/version.deletelabel.json"+b,{data:JSON.stringify({label:d,path:b})},_.bind(function(a){this.hide()},
this),_.bind(function(a){this.alert("danger","Error on deleting version label",a)},this));return!1}});c.AddLabelDialog=a.components.Dialog.extend({initialize:function(b){a.components.Dialog.prototype.initialize.apply(this,[b]);this.$form=a.getWidget(this.el,"form.widget-form",a.components.FormWidget);this.$path=this.$('input[name="path"]');this.$name=this.$('input[name="name"]');this.$labelname=a.getWidget(this.el,'input[name="labelname"]',a.components.TextFieldWidget);this.$("button.create").click(_.bind(this.addNewLabel,
this));this.$el.on("shown.bs.modal",function(){$(this).find('input[name="labelname"]').focus()})},setVersion:function(a,d){this.$path.val(a);this.$name.val(d)},addNewLabel:function(b){b.preventDefault();b=c.getCurrentPath();var d=this.$name.val(),e=this.$labelname.getValue();a.ajaxPut("/bin/cpm/nodes/version.addlabel.json"+b,JSON.stringify({version:d,label:e,path:b}),{},_.bind(function(a){this.hide()},this),_.bind(function(b){a.alert("danger","Error","Error on adding version label",b)},this));return!1}});
c.getVersionsTab=function(){return a.getView(".node-view-panel .versions",c.VersionsTab)};c.VersionsTab=a.console.DetailTab.extend({initialize:function(b){this.table=a.getWidget(this.$el,".table-container",c.VersionsTable);this.$addButton=this.$(".table-toolbar .add");this.$addButton.click(_.bind(this.addLabel,this));this.$removeButton=this.$(".table-toolbar .remove");this.$removeButton.click(_.bind(this.removeLabel,this));this.$deleteButton=this.$(".table-toolbar .delete");this.$deleteButton.click(_.bind(this.deleteVersion,
this));this.$restoreButton=this.$(".table-toolbar .restore");this.$restoreButton.click(_.bind(this.restoreVersion,this));this.$checkin=this.$(".table-toolbar .checkin");this.$checkin.click(_.bind(this.checkin,this));this.$checkout=this.$(".table-toolbar .checkout");this.$checkout.click(_.bind(this.checkout,this));this.$checkpoint=this.$(".table-toolbar .checkpoint");this.$checkpoint.click(_.bind(this.checkpoint,this));b=c.getCurrentPath();a.getJson("/bin/cpm/nodes/node.tree.json"+b,_.bind(function(a){a.jcrState.isVersionable&&
a.jcrState.checkedOut?this.$checkpoint.removeClass("disabled"):this.$checkpoint.addClass("disabled");a.jcrState.isVersionable?(this.$checkin.removeClass("disabled"),this.$checkout.removeClass("disabled"),this.$restoreButton.removeClass("disabled"),this.$deleteButton.removeClass("disabled"),this.$removeButton.removeClass("disabled"),this.$addButton.removeClass("disabled")):(this.$checkin.addClass("disabled"),this.$checkout.addClass("disabled"),this.$restoreButton.addClass("disabled"),this.$deleteButton.addClass("disabled"),
this.$removeButton.addClass("disabled"),this.$addButton.addClass("disabled"))},this))},reload:function(){this.table.loadContent()},addLabel:function(a){var b=c.getCurrentPath(),e=c.getAddLabelDialog(),f=this.table.getSelections();e.show(function(){e.setVersion(b,f[0].name)},_.bind(this.reload,this))},removeLabel:function(a){c.getDeleteLabelDialog().show(void 0,_.bind(this.reload,this))},checkpoint:function(b){b=c.getCurrentPath();a.ajaxPost("/bin/cpm/nodes/version.checkpoint.json"+b,{},{},_.bind(function(b){a.browser.tree.refresh();
a.browser.nodeView.reload()},this),_.bind(function(b){a.alert("danger","Error","Error creating checkpoint",b)},this))},checkin:function(b){b=c.getCurrentPath();a.ajaxPost("/bin/cpm/nodes/version.checkin.json"+b,{},{},_.bind(function(b){a.browser.tree.refresh();a.browser.nodeView.reload()},this),_.bind(function(b){a.alert("danger","Error","Error checking in node",b)},this))},checkout:function(b){b=c.getCurrentPath();a.ajaxPost("/bin/cpm/nodes/version.checkout.json"+b,{},{},_.bind(function(b){a.browser.tree.refresh();
a.browser.nodeView.reload()},this),_.bind(function(b){a.alert("danger","Error","Error checking out node",b)},this))},deleteVersion:function(a){var b=c.getDeleteVersionDialog(),e=this.table.getSelections();b.show(function(){b.setVersion(0==e.length?"":e[0].name)},_.bind(this.reload,this))},restoreVersion:function(b){b=this.table.getSelections()[0].name;var d=c.getCurrentPath();a.ajaxPut("/bin/cpm/nodes/version.restore.json"+d,JSON.stringify({version:b,path:d}),{},_.bind(function(a){this.reload()},
this),_.bind(function(b){a.alert("danger","Error","Error on restoring version label",b)},this))}});c.VersionsTable=Backbone.View.extend({initialize:function(a){this.state={load:!1};this.$table=this.$(".version-table");this.$table.bootstrapTable({search:!0,showToggle:!1,striped:!0,singleSelect:!0,clickToSelect:!0,rowStyle:_.bind(function(a,b){return{classes:a.current?"editable current":"protected"}},this),columns:[{"class":"selection",radio:!0,sortable:!1},{"class":"name",field:"name",title:"Name"},
{"class":"date",field:"date",title:"Date"},{"class":"labels",field:"labels",title:"Labels",formatter:_.bind(this.formatValue,this)}]})},formatValue:function(a,c,e){c="&nbsp;";for(var b in a)c=c+'<span class="label label-primary">'+a[b]+"</span>\n";return c},getSelections:function(){return this.$table.bootstrapTable("getSelections")},loadContent:function(){var b=c.getCurrentPath();this.state.load=!0;a.getJson("/bin/cpm/nodes/version.versions.json"+b,_.bind(function(a){this.$table.bootstrapTable("load",
a)},this),_.bind(function(b){a.alert("danger","Error","Error on loading properties",b)},this),_.bind(function(a){this.state.load=!1},this))}})})(a.browser)})(window.core);
