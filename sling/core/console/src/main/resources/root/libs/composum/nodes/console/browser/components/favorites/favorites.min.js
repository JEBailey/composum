var $jscomp={scope:{},findInternal:function(b,a,c){b instanceof String&&(b=String(b));for(var e=b.length,d=0;d<e;d++){var f=b[d];if(a.call(c,f,d,b))return{i:d,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,a,c,e){if(a){c=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var d=b[e];d in c||(c[d]={});c=c[d]}b=b[b.length-1];e=c[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
(function(b){b.Favorites=Backbone.View.extend({initialize:function(a){this.$favorites=this.$(".marked-nodes");this.$favoritesList=this.$favorites.find("> ol");this.$recently=this.$(".used-recently");this.$recentlyList=this.$recently.find("> ol");this.$template=this.$("> .template a");this.$(".action-bar .favorites").click(_.bind(this.showFavoritesTab,this));this.$(".action-bar .history").click(_.bind(this.showHistoryTab,this));this.$(".action-bar .close").click(_.bind(b.navigation.toggleFavorites,
b.navigation));this.$(".action-bar .clear-favorites").on("click",_.bind(this.clearFavorites,this));this.$(".action-bar .clear-recently").on("click",_.bind(this.clearHistory,this));$(document).on("favorite:toggle",_.bind(this.onToggleFavorite,this));$(document).on("path:selected",_.bind(this.onPathSelected,this));this.loadProfile();"history"==core.console.getProfile().get("navigation","tab")&&this.showHistoryTab()},showFavoritesTab:function(a){a&&a.preventDefault();this.$el.removeClass("history").addClass("favorites");
core.console.getProfile().set("navigation","tab","favorites")},showHistoryTab:function(a){a&&a.preventDefault();this.$el.removeClass("favorites").addClass("history");core.console.getProfile().set("navigation","tab","history")},onSelect:function(a){a.preventDefault();a.stopPropagation();$(document).trigger("path:select",[a.data.path])},isFavorite:function(a){return void 0!==this.getFavorite(a)},onToggleFavorite:function(a,c){this.toggleFavorite(c)},toggleFavorite:function(a){this.isFavorite(a)?this.removeFavorite(a):
this.addFavorite(a)},getFavorite:function(a){return(a=this.$favoritesList.find('a[data-path="'+a+'"]'))&&0<a.length?a:void 0},addFavorite:function(a){if(!this.isFavorite(a)){for(var c=this.$favoritesList.find("> a"),b=void 0,d=0;d<c.length;d++)if($(c[d]).attr("data-path")>a){b=$(c[d]);break}a=this.createItem(a);b?b.before(a):this.$favoritesList.append(a);this.saveProfile()}},removeFavorite:function(a){if(a=this.getFavorite(a))a.remove(),this.saveProfile()},onPathSelected:function(a,c){this.notifyUsage(c);
this.$favoritesList.children().removeClass("active");var b=this.getFavorite(c);b&&b.addClass("active")},notifyUsage:function(a){this.$recentlyList.find('a[data-path="'+a+'"]').each(function(){this.remove()});this.$recentlyList.prepend(this.createItem(a));a=this.$recentlyList.children();for(var c=a.length;20<--c;)$(a[c]).remove();this.saveProfile()},createItem:function(a){var c=this.$template.clone();c.attr("data-path",a);c.find(".path").text(a);c.click({path:a},_.bind(this.onSelect,this));this.setItemState(c);
return c},setItemState:function(a){var c=a.attr("data-path");c==b.getCurrentPath()?this.setNodeState(a,b.current.node):core.getJson("/bin/cpm/nodes/node.tree.json"+c,_.bind(function(c){this.setNodeState(a,c)},this),_.bind(function(c){a.remove()},this))},setNodeState:function(a,c){if(c){a.find(".name").text(c.name?c.name:"jcr:root");var b=core.components.treeTypes[c.type];b||(b=core.components.treeTypes["default"]);a.find("i").addClass(b.icon)}},clearFavorites:function(a){a.preventDefault();a.stopPropagation();
this.$favoritesList.html("");this.saveProfile()},clearHistory:function(a){a.preventDefault();a.stopPropagation();this.$recentlyList.html("");this.saveProfile()},loadProfile:function(){this.loadProfileList("favorites",this.$favoritesList);this.loadProfileList("recently",this.$recentlyList)},loadProfileList:function(a,c){var b=core.console.getProfile().get("favorites",a);if(_.isArray(b))for(var d=0;d<b.length;d++){var f=this.createItem(b[d]);f&&c.append(f)}},saveProfile:function(){this.saveProfileList("favorites",
this.$favoritesList);this.saveProfileList("recently",this.$recentlyList)},saveProfileList:function(a,b){var c=[];b.children().each(function(){c.push($(this).attr("data-path"))});core.console.getProfile().set("favorites",a,c)}});b.favorites=core.getView("#favorites-view",b.Favorites)})(window.core.browser);
