var $jscomp={scope:{},findInternal:function(c,d,a){c instanceof String&&(c=String(c));for(var b=c.length,e=0;e<b;e++){var f=c[e];if(d.call(a,f,e,c))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,d,a){if(a.get||a.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[d]=a.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,d,a,b){if(d){a=$jscomp.global;c=c.split(".");for(b=0;b<c.length-1;b++){var e=c[b];e in a||(a[e]={});a=a[e]}c=c[c.length-1];b=a[c];d=d(b);d!=b&&null!=d&&$jscomp.defineProperty(a,c,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,a){return $jscomp.findInternal(this,c,a).v}},"es6-impl","es3");
(function(c){c.browser=c.browser||{};(function(d){d.current={};d.getCurrentPath=function(){return d.current?d.current.path:void 0};d.setCurrentPath=function(a,b){d.current&&d.current.path==a||(a?d.refreshCurrentPath(a,_.bind(function(e){c.console.getProfile().set("browser","current",a);history.replaceState&&history.replaceState(d.current.path,name,d.current.nodeUrl);b||$(document).trigger("path:selected",[a])},this)):(d.current=void 0,b||$(document).trigger("path:selected",[a])))};d.refreshCurrentPath=
function(a,b){!a&&d.current&&(a=d.current.path);a&&c.getJson("/bin/cpm/nodes/node.tree.json"+a,void 0,void 0,_.bind(function(e){d.current={path:a,node:e.responseJSON,viewUrl:c.getContextUrl("/bin/browser.view.html"+window.core.encodePath(a)),nodeUrl:c.getContextUrl("/bin/browser.html"+window.core.encodePath(a))};_.isFunction(b)&&b.call(this,a)},this))};d.Browser=c.components.SplitView.extend({initialize:function(a){c.components.SplitView.prototype.initialize.apply(this,[a]);$(document).on("path:select.Browser",
_.bind(this.onPathSelect,this));$(document).on("path:selected.Browser",_.bind(this.onPathSelected,this));$(document).on("path:changed.Browser",_.bind(this.onPathChanged,this));c.unauthorizedDelegate=c.console.authorize},onPathSelect:function(a,b){b||(b=a.data.path);d.setCurrentPath(b)},onPathSelected:function(a,b){d.treeActions.refreshNodeState()},onPathChanged:function(a,b){d.refreshCurrentPath(b,_.bind(function(){d.treeActions.refreshNodeState()},this))}});d.browser=c.getView("#browser",d.Browser);
d.Tree=c.components.Tree.extend({nodeIdPrefix:"BT_",initialize:function(a){a=_.extend(a||{},{dragAndDrop:{is_draggable:_.bind(this.nodeIsDraggable,this),inside_pos:"last",copy:!1,check_while_dragging:!1,drag_selection:!1,touch:!1,large_drag_target:!0,large_drop_target:!0,use_html5:!1}});this.initialSelect=this.$el.attr("data-selected");this.initialSelect&&"/"!=this.initialSelect||(this.initialSelect=c.console.getProfile().get(this.getProfileId(),"current","/"));this.initializeFilter();c.components.Tree.prototype.initialize.apply(this,
[a]);this.$jstree.on("keydown.BrowserTree",".jstree-anchor",_.bind(this.customKeys,this))},getProfileId:function(){return"browser"},initializeFilter:function(){this.filter=c.console.getProfile().get(this.getProfileId(),"filter")},customKeys:function(a){var b=a.target.tagName;if(b&&"input"===b.toLowerCase())return!0;if(b=this.jstree.get_node(a.currentTarget.id))switch(b=b.original.path,a.which){case 68:if(!a.ctrlKey&&!a.metaKey)break;case 189:return a.preventDefault(),this.findNearestOfDeletion(b),
d.treeActions.deleteNode(void 0,b),!1;case 65:if(!a.ctrlKey&&!a.metaKey)break;case 187:return a.preventDefault(),d.treeActions.createNode(void 0,b,_.bind(function(){a.currentTarget.focus()},this)),!1;case 67:if(a.ctrlKey||a.metaKey)return a.preventDefault(),d.treeActions.clipboardCopy(void 0,b,_.bind(function(){a.currentTarget.focus()},this)),!1;break;case 86:if(a.ctrlKey||a.metaKey)return a.preventDefault(),d.treeActions.clipboardPaste(void 0,b,_.bind(function(){a.currentTarget.focus()},this)),!1;
break;case 82:if(a.ctrlKey||a.metaKey)return a.preventDefault(),d.treeActions.refreshNode(void 0,b,_.bind(function(){a.currentTarget.focus()},this)),!1}return!0},nodeIsDraggable:function(a,b){return!0},renameNode:function(a,b,d){var e=c.getParentPath(a.path),g=c.buildContentPath(e,b),h=c.buildContentPath(e,d);c.ajaxPut("/bin/cpm/nodes/node.move.json"+c.encodePath(g),JSON.stringify({path:e,name:d}),{dataType:"json"},_.bind(function(a){$(document).trigger("path:moved",[g,h])},this),_.bind(function(b){var e=
c.nodes.getRenameNodeDialog();e.show(_.bind(function(){e.setNode(a,d);e.alert("danger","Error on renaming node!",b)},this))},this))},dropNode:function(a,b,d){var e=b.path,g=a.path,h=c.getNameFromPath(g),k=c.buildContentPath(e,h);c.ajaxPut("/bin/cpm/nodes/node.move.json"+c.encodePath(g),JSON.stringify({path:e,name:h,index:d}),{dataType:"json"},_.bind(function(a){$(document).trigger("path:moved",[g,k])},this),_.bind(function(e){var f=c.nodes.getMoveNodeDialog();f.show(_.bind(function(){f.setValues(a,
b,d);f.alert("danger","Error on moving node!",e)},this))},this))},dataUrlForPath:function(a){return"/bin/cpm/nodes/node.tree.json"+a+(this.filter&&"default"!=this.filter?"?filter="+this.filter:"")}});d.tree=c.getView("#browser-tree",d.Tree);d.TreeActions=Backbone.View.extend({initialize:function(a){this.tree=d.tree;this.$toggleLock=this.$("a.lock");this.$toggleCheckout=this.$("a.checkout");this.$("a.move").on("click",_.bind(this.moveNode,this));this.$("a.rename").on("click",_.bind(this.renameNode,
this));this.$("a.mixins").on("click",_.bind(this.nodeMixins,this));this.$toggleLock.on("click",_.bind(this.toggleLock,this));this.$toggleCheckout.on("click",_.bind(this.toggleCheckout,this));this.$("button.refresh").on("click",_.bind(this.refreshNode,this));this.$("button.create").on("click",_.bind(this.createNode,this));this.$("button.delete").on("click",_.bind(this.deleteNode,this));this.$("button.copy").on("click",_.bind(this.clipboardCopy,this));this.$("button.paste").on("click",_.bind(this.clipboardPaste,
this));this.$filters=this.$(".filter .dropdown-menu");c.getHtml("/bin/cpm/nodes/node.filters.html",_.bind(function(a){this.$filters.html(a);this.$filters.find("li>a").click(_.bind(this.setFilter,this));this.setFilterLabel(c.console.getProfile().get("browser","filter"))},this));this.$("button.favorites").on("click",_.bind(this.toggleFavorites,this))},getCurrent:function(){return d.current},getCurrentPath:function(){return d.getCurrentPath()},toggleFavorites:function(a){return d.navigation.toggleFavorites(a)},
setFilter:function(a){a.preventDefault();a=$(a.currentTarget).text();this.tree.setFilter(a);this.setFilterLabel(a);c.console.getProfile().set("browser","filter",a)},setFilterLabel:function(a){this.$(".filter label span").text(a);this.$filters.find("li").removeClass("active");this.$filters.find('li[data-filter="'+a+'"]').addClass("active")},refreshNodeState:function(){var a=this.getCurrent();a&&(a=a.node)&&a.jcrState&&(this.$toggleLock.text(a.jcrState.locked?"Unlock":"Lock"),this.$toggleCheckout.text(a.jcrState.checkedOut?
"Checkin":"Checkout"),a.jcrState.isVersionable?this.$toggleCheckout.parent().removeClass("disabled"):this.$toggleCheckout.parent().addClass("disabled"))},clipboardCopy:function(a,b,d){a&&a.preventDefault();b||(b=this.getCurrentPath());c.console.getProfile().set("nodes","clipboard",{path:b});_.isFunction(d)&&d.call(this,b)},clipboardPaste:function(a,b,d){a&&a.preventDefault();b||(b=this.getCurrentPath());var e=c.console.getProfile().get("nodes","clipboard");if(b&&e&&e.path){var g=c.getNameFromPath(e.path);
c.ajaxPut("/bin/cpm/nodes/node.copy.json"+b,JSON.stringify({path:e.path,name:g}),{dataType:"json"},_.bind(function(a){$(document).trigger("path:inserted",[b,g])},this),_.bind(function(a){var f=c.nodes.getCopyNodeDialog();f.show(_.bind(function(){f.setNodePath(e.path);f.setTargetPath(b);f.alert("danger","Error on copying node!",a)},this),_.bind(function(){_.isFunction(d)&&d.call(this,b)},this))},this))}},moveNode:function(a){a&&a.preventDefault();var b=c.nodes.getMoveNodeDialog();b.show(_.bind(function(){b.setNode(this.tree.current())},
this))},renameNode:function(a){a&&a.preventDefault();var b=c.nodes.getRenameNodeDialog();b.show(_.bind(function(){b.setNode(this.tree.current())},this))},nodeMixins:function(a){a&&a.preventDefault();var b=c.nodes.getNodeMixinsDialog();b.show(_.bind(function(){b.setNode(this.tree.current())},this))},toggleCheckout:function(a){a&&a.preventDefault();var b=this.tree.current();b&&c.ajaxPost("/bin/cpm/nodes/version."+(b.jcrState.checkedOut?"checkin":"checkout")+".json"+b.path,{},{},_.bind(function(a){$(document).trigger("path:changed",
[b.path])},this),_.bind(function(a){c.alert("danger","Error","Error on toggle node lock",a)},this))},toggleLock:function(a){a&&a.preventDefault();var b=this.tree.current();b&&c.ajaxPost("/bin/cpm/nodes/node.toggle.lock"+b.path,{},{},void 0,void 0,_.bind(function(a){200==a.status?$(document).trigger("path:changed",[b.path]):c.alert("danger","Error","Error on toggle node lock",a)},this))},createNode:function(a,b,d){a&&a.preventDefault();b||(b=this.tree.getSelectedPath());var e=c.nodes.getCreateNodeDialog();
e.show(_.bind(function(){b&&e.initParentPath(b)},this),_.bind(function(){_.isFunction(d)&&d.call(this,b)},this))},deleteNode:function(a,b,d){a&&a.preventDefault();b||(b=this.tree.getSelectedPath());if(b){var e=c.nodes.getDeleteNodeDialog();e.show(_.bind(function(){e.setPath(b);a&&(a.ctrlKey||a.metaKey)&&e.setSmart(!1)},this),_.bind(function(){_.isFunction(d)&&d.call(this,b)},this))}},refreshNode:function(a,b,c){a&&a.preventDefault();a=void 0;b&&(a=this.tree.nodeId(b));this.tree.refreshNodeById(a);
_.isFunction(c)&&c.call(this,b)}});d.treeActions=c.getView("#browser-tree-actions",d.TreeActions);d.Breadcrumbs=Backbone.View.extend({initialize:function(a){this.$("a").on("click",_.bind(this.pathSelected,this))},pathSelected:function(a){a.preventDefault();a=$(a.currentTarget).closest("li").attr("data-path");d.setCurrentPath(a);return!1}});d.getBreadcrumbs=function(){return c.getView("#browser-view .breadcrumbs",d.Breadcrumbs)}})(c.browser)})(window.core);
