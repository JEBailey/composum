(function(b){b.browser=b.browser||{};(function(e){e.PoliciesTab=b.console.DetailTab.extend({initialize:function(c){this.verticalSplit=b.getWidget(this.$el,".split-pane.vertical-split",b.components.VerticalSplitPane);this.localTable=b.getWidget(this.$el,".local-policies > table",e.PoliciesTable,{selectable:!0});this.effectiveTable=b.getWidget(this.$el,".effective-policies > table",e.PoliciesTable);this.$(".acl-toolbar .add").click(_.bind(this.addAcl,this));this.$(".acl-toolbar .remove").click(_.bind(this.removeSelection,
this));this.$(".acl-toolbar .up").click(_.bind(this.up,this));this.$(".acl-toolbar .down").click(_.bind(this.down,this))},reload:function(b){this.loadTableData(this.localTable,"local",b);this.loadTableData(this.effectiveTable,"effective")},loadTableData:function(c,a,d){var f=e.getCurrentPath();b.getJson("/bin/cpm/nodes/security.accessPolicies."+a+".json"+f,_.bind(function(b){var a=0;_.each(b,function(b){b.index=a;a++});c.$el.bootstrapTable("load",b)},this),_.bind(function(a){b.alert("danger","Error",
"Error on loading policies",a)},this),_.bind(function(b){_.isFunction(d)&&d(b)},this))},addAcl:function(b){e.openAccessPolicyEntryDialog(_.bind(this.reload,this))},up:function(c){c=e.getCurrentPath();var a=this.localTable.getSelections()[0];if(a&&0<a.index){var d=this.localTable.getData(a.index-1);this.localTable.getData(a.index+1);b.ajaxPost("/bin/cpm/nodes/security.reorder.json"+c,{object:JSON.stringify(a),before:JSON.stringify(d)},{dataType:"json"},_.bind(function(b){this.reload(_.bind(function(){this.localTable.check(a.index-
1)},this))},this),_.bind(function(a){b.alert("danger","Error","Error on reorder access policy entries",a)},this))}},down:function(c){c=e.getCurrentPath();var a=this.localTable.getSelections()[0];this.localTable.getData(a.index-1);var d=this.localTable.getData(a.index+1);a&&a.index+1<this.localTable.numberOfRows()&&b.ajaxPost("/bin/cpm/nodes/security.reorder.json"+c,{object:JSON.stringify(a),before:JSON.stringify(d)},{dataType:"json"},_.bind(function(b){this.reload(_.bind(function(){this.localTable.check(a.index+
1)},this))},this),_.bind(function(a){b.alert("danger","Error","Error on reorder access policy entries",a)},this))},removeSelection:function(c){c=e.getCurrentPath();for(var a=this.localTable.getSelections(),d=[],f=0;f<a.length;f++)d[f]=a[f];c&&d&&b.ajaxDelete("/bin/cpm/nodes/security.accessPolicy.json"+c,{data:JSON.stringify(d),dataType:"json"},_.bind(function(b){this.reload()},this),_.bind(function(a){200>a.status||299<a.status?b.alert("danger","Error","Error on removing access policy entries",a):
this.reload()},this))}})})(b.browser)})(window.core);
