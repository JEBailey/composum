(function(c){c.components=c.components||{};(function(f){f.Dialog=Backbone.View.extend({initialize:function(a){this.$alert=this.$(".alert");this.setUpWidgets(this.el);this.$el.on("shown.bs.modal",_.bind(this.onShown,this))},setUpWidgets:function(a){window.widgets.setUp(a)},widgetOf:function(a){return c.widgetOf(a)},show:function(a,b){this.initView=a;this.callback=b;this.$el.modal("show")},onShown:function(){this.resetOnShown();_.isFunction(this.initView)&&this.initView()},resetOnShown:function(){this.reset()},
hide:function(){this.$el.modal("hide");_.isFunction(this.callback)&&this.callback();this.reset()},reset:function(){this.alert();this.$("input,textarea,select").each(function(){"radio"!=this.type&&$(this).val(void 0)});this.$(".widget").each(function(){this.view&&_.isFunction(this.view.reset)&&this.view.reset.apply(this.view)})},alert:function(a,b,d){this.$alert.removeClass();b?(this.$alert.html(d?c.resultMessage(d,b):b),this.$alert.addClass("alert").addClass("alert-"+a)):(this.$alert.html(""),this.$alert.addClass("alert").addClass("alert-hidden"))},
submitForm:function(a,b,d){c.submitForm(this.el,_.bind(function(b){_.isFunction(a)&&a(b);this.hide()},this),_.bind(function(a){_.isFunction(b)?b(a):(void 0===b||b)&&this.alert("danger","Error on submit",a)},this),d)},submitFormPut:function(a,b,d){var e=c.getWidget(this.el,"form.widget-form",c.components.FormWidget);c.submitFormPut(this.el,e?e.getValues.apply(e):void 0,_.bind(function(b){_.isFunction(a)&&a(b);this.hide()},this),_.bind(function(a){_.isFunction(b)?b(a):(void 0===b||b)&&this.alert("danger",
"Error on submit",a)},this),d)},submitPUT:function(a,b,d,e){c.ajaxPut(b,JSON.stringify(d),{dataType:"json"},e,void 0,_.bind(function(b){200==b.status?(_.isFunction(e)&&e(b),this.hide()):this.alert("danger","Error on "+a,b)},this))}});f.SelectPathDialog=f.Dialog.extend({initialize:function(a){f.Dialog.prototype.initialize.apply(this,[a]);this.busy=!1;this.tree=c.getView(this.$(".path-select-tree"),f.Tree);this.tree.onNodeSelected=_.bind(this.onNodeSelected,this);this.$title=this.$(".modal-title");
this.$label=this.$(".path-input-label");this.$input=this.$("input.path-input");this.$input.on("change",_.bind(this.inputChanged,this));this.$("button.select").click(_.bind(function(){_.isFunction(this.callback)&&this.callback(this.getValue());this.hide()},this))},onShown:function(){c.components.Dialog.prototype.onShown.apply(this);this.inputChanged()},setTitle:function(a){this.$title.text(a?a:this.$title.data("default"))},setLabel:function(a){this.$label.text(a?a:this.$label.data("default"))},setRootPath:function(a){this.tree.setRootPath(a)},
setFilter:function(a){this.tree.setFilter(a)},getValue:function(){return this.$input.val()},setValue:function(a){this.$input.val(a);this.inputChanged()},inputChanged:function(){if(!this.busy){this.busy=!0;var a=this.getValue();0===a.indexOf("/")&&c.getJson("/bin/cpm/nodes/node.tree.json"+a,_.bind(function(a){this.tree.selectNode.apply(this.tree,[a.path])},this));this.busy=!1}},onNodeSelected:function(a){this.busy||(this.busy=!0,this.setValue(a),this.busy=!1)},reset:function(){f.Dialog.prototype.reset.apply(this);
this.tree.reset.apply(this.tree)}})})(c.components)})(window.core);
