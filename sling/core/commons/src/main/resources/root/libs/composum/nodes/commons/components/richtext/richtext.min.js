var $jscomp={scope:{},findInternal:function(a,c,b){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var f=a[d];if(c.call(b,f,d,a))return{i:d,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,e){if(c){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in b||(b[d]={});b=b[d]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
(function(a){a.components=a.components||{};(function(c){c["const"]=_.extend(c["const"]||{},{richtext:{editorSelector:".rich-editor",defaultOptions:{btns:[["bold","italic","underline","strikethrough"],["superscript","subscript"],["removeformat"],"btnGrp-lists",["link","unlink"]],removeformatPasted:!0}}});c.RichTextWidget=widgets.Widget.extend({initialize:function(a){widgets.Widget.prototype.initialize.apply(this,[a]);this.$editor=this.richText();this.$editor.trumbowyg(c["const"].richtext.defaultOptions);
(a=this.$el.data("style"))&&this.$(".trumbowyg-editor").attr("style",a);this.$editor.on("tbwchange",_.bind(this.onChange,this))},getValue:function(){return this.$editor.trumbowyg("html")},setValue:function(a,c){this.$editor.trumbowyg("html",a);c&&this.$el.trigger("change")},reset:function(){this.$editor.trumbowyg("empty")},onChange:function(){this.$el.trigger("change")},richText:function(){return this.$el.is(c["const"].richtext.editorSelector)?this.$el:this.$(c["const"].richtext.editorSelector)}});
widgets.register(".widget.richtext-widget",c.RichTextWidget,{afterClone:function(){var a=$(this),c=$(document.createElement("div")),d=a.find(".composum-widgets-richtext_value").clone();c.append(d);a.html(c.html())}});c.trumbowyg={openModalWidgets:function(b,c,d){var f=this;a.getHtml(b,function(b){b=f.openModal("Content Link",b);var e=a.getWidget(b[0],"form",a.components.FormWidget),h={};b.addClass("composum-widgets-richtext_link-dialog");window.widgets.setUp(e.el);e.$("[name]").each(function(){var b=
$(this).attr("name");if(b){var d=a.widgetOf(this);if(d){var f=c[b];d.setValue(f?f:void 0);h[b]=d}}});b.on("tbwconfirm",function(){if(e.validate()){for(var a in h)c[a]=h[a].getValue();d(c)&&(f.syncCode(),f.$c.trigger("tbwchange"),f.closeModal(),$(this).off("tbwconfirm"))}});b.one("tbwcancel",function(){$(this).off("tbwconfirm");f.closeModal()})})}};$.extend(!0,$.trumbowyg,{plugins:{contentLink:{init:function(a){a.addBtnDef("link",{fn:function(){var b=function(b){a.restoreRange();var c=$(['<a href="',
b.url,'">',b.text,"</a>"].join(""));0<b.title.length&&c.attr("title",b.title);0<b.target.length&&c.attr("target",b.target);a.range.deleteContents();a.range.insertNode(c[0]);return!0};(function(){for(var d=a.doc.getSelection(),f=d.focusNode,e={};0>["A","DIV"].indexOf(f.nodeName);)f=f.parentNode;if(f&&"A"===f.nodeName){var g=$(f);e.url=g.attr("href");e.title=g.attr("title");e.target=g.attr("target");g=a.doc.createRange();g.selectNode(f);d.addRange(g)}a.saveRange();e.text=a.getRangeText();c.trumbowyg.openModalWidgets.apply(a,
["/libs/composum/nodes/commons/components/richtext/link/dialog.html",e,b])})()}})}}}})})(a.components)})(window.core);
