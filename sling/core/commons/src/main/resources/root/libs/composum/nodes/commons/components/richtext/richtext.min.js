var $jscomp={scope:{},findInternal:function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,f=0;f<d;f++){var e=a[f];if(c.call(b,e,f,a))return{i:f,v:e}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in b||(b[f]={});b=b[f]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");
(function(a){a.components=a.components||{};(function(c){c["const"]=_.extend(c["const"]||{},{richtext:{editorSelector:".rich-editor",defaultOptions:{btns:[["bold","italic","underline","strikethrough"],["superscript","subscript"],["removeformat"],"btnGrp-lists",["link","unlink"]],removeformatPasted:!0}}});c.RichTextWidget=Backbone.View.extend({initialize:function(a){this.$editor=this.richText();this.$editor.trumbowyg(c["const"].richtext.defaultOptions);(a=this.$el.data("style"))&&this.$(".trumbowyg-editor").attr("style",
a);this.$editor.on("tbwchange",_.bind(this.onChange,this))},getValue:function(){return this.$editor.trumbowyg("html")},setValue:function(a,c){this.$editor.trumbowyg("html",a);c&&this.$el.trigger("change")},reset:function(){this.$editor.trumbowyg("empty")},onChange:function(){this.$el.trigger("change")},richText:function(){return this.$el.is(c["const"].richtext.editorSelector)?this.$el:this.$(c["const"].richtext.editorSelector)}});widgets.register(".widget.richtext-widget",c.RichTextWidget);c.richTextWidget=
{afterClone:function(a){var b=$(document.createElement("div")),c=a.find(".composum-widgets-richtext_value").clone();b.append(c);a.html(b.html())}};c.trumbowyg={openModalWidgets:function(b,c,f){var e=this;a.getHtml(b,function(b){b=e.openModal("Content Link",b);var d=a.getWidget(b[0],"form",a.components.FormWidget),h={};b.addClass("composum-widgets-richtext_link-dialog");window.widgets.setUp(d.el);d.$("[name]").each(function(){var b=$(this).attr("name");if(b){var f=a.widgetOf(this);if(f){var e=c[b];
f.setValue(e?e:void 0);h[b]=f}}});b.on("tbwconfirm",function(){if(d.validate()){for(var a in h)c[a]=h[a].getValue();f(c)&&(e.syncCode(),e.$c.trigger("tbwchange"),e.closeModal(),$(this).off("tbwconfirm"))}});b.one("tbwcancel",function(){$(this).off("tbwconfirm");e.closeModal()})})}};$.extend(!0,$.trumbowyg,{plugins:{contentLink:{init:function(a){a.addBtnDef("link",{fn:function(){var b=function(b){a.restoreRange();var c=$(['<a href="',b.url,'">',b.text,"</a>"].join(""));0<b.title.length&&c.attr("title",
b.title);0<b.target.length&&c.attr("target",b.target);a.range.deleteContents();a.range.insertNode(c[0]);return!0};(function(){for(var f=a.doc.getSelection(),e=f.focusNode,d={};0>["A","DIV"].indexOf(e.nodeName);)e=e.parentNode;if(e&&"A"===e.nodeName){var g=$(e);d.url=g.attr("href");d.title=g.attr("title");d.target=g.attr("target");g=a.doc.createRange();g.selectNode(e);f.addRange(g)}a.saveRange();d.text=a.getRangeText();c.trumbowyg.openModalWidgets.apply(a,["/libs/composum/nodes/commons/components/richtext/link/dialog.html",
d,b])})()}})}}}})})(a.components)})(window.core);
