var $jscomp={scope:{},findInternal:function(e,c,d){e instanceof String&&(e=String(e));for(var a=e.length,b=0;b<a;b++){var g=e[b];if(c.call(d,g,b,e))return{i:b,v:g}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,c,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[c]=d.value)};
$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,c,d,a){if(c){d=$jscomp.global;e=e.split(".");for(a=0;a<e.length-1;a++){var b=e[a];b in d||(d[b]={});d=d[b]}e=e[e.length-1];a=d[e];c=c(a);c!=a&&null!=c&&$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(c,d){return $jscomp.findInternal(this,c,d).v}},"es6-impl","es3");
(function(e){e.components=e.components||{};(function(c,d){c["const"]=_.extend(c["const"]||{},{form:{css:{base:"form-widget",action:{slingPost:"form-action_Sling-POST"},status:{valid:"valid-form",invalid:"invalid-form"},selector:{item:".multi-form-item"}}}});c.FormWidget=Backbone.View.extend({initialize:function(a){this.isSlingPost=this.$el.hasClass(c["const"].form.css.action.slingPost)},isValid:function(a){return this.validate(a)},validationReset:function(){this.$(d["const"].css.selector.general).each(function(){this.view&&
_.isFunction(this.view.validationReset)&&this.view.validationReset.apply(this.view)})},validate:function(a){var b=c["const"].form,g=!0;this.$(d["const"].css.selector.general).each(function(){this.view&&_.isFunction(this.view.isValid)&&(g=this.view.isValid.apply(this.view,[a])&&g)});g?(this.$el.removeClass(b.css.status.invalid),this.$el.addClass(b.css.status.valid)):(this.$el.removeClass(b.css.status.valid),this.$el.addClass(b.css.status.invalid));return g},getValues:function(){var a=c["const"].form,
b={};this.$(".widget").each(function(){if(this.view&&0==this.view.$el.parent().closest(a.css.selector.item).length&&_.isFunction(this.view.getValue))for(var c=e.getWidgetNames(this.view),d=b,f=0;f<c.length;f++)f<c.length-1?(d[c[f]]=d[c[f]]||{},d=d[c[f]]):d[c[f]]=this.view.getValue.apply(this.view)});return b},setValues:function(a){var b=c["const"].form;this.$(".widget").each(function(){if(this.view&&0==this.view.$el.parent().closest(b.css.selector.item).length&&_.isFunction(this.view.setValue))for(var c=
e.getWidgetNames(this.view),d=a,f=0;f<c.length;f++)f<c.length-1?d&&(d=d[c[f]]):this.view.setValue.apply(this.view,[d?d[c[f]]:void 0])})},reset:function(){this.$(".widget").each(function(){this.view&&_.isFunction(this.view.reset)&&this.view.reset.apply(this.view)})},prepare:function(){this.$(d["const"].css.selector.general).each(function(){this.view&&_.isFunction(this.view.prepare)&&this.view.prepare.apply(this.view)})},submitForm:function(a,b,c){e.submitForm(this.el,a,b,c)},submitFormPut:function(a,
b,c){e.submitFormPut(this.el,this.getValues(),a,b,c)}});d.register("form.widget-form",c.FormWidget);c.CheckboxWidget=d.Widget.extend({initialize:function(a){d.Widget.prototype.initialize.apply(this,[a]);this.$typeHint=this.$("sling-post-type-hint");this.$deleteHint=this.$("sling-post-delete-hint")},retrieveInput:function(){return this.$el.is('input[type="checkbox"]')?this.$el:this.$('input[type="checkbox"]')},declareName:function(a){a?(this.$input.attr(d["const"].attr.name,a),this.$typeHint.attr(d["const"].attr.name,
a+"@TypeHint"),this.$deleteHint.attr(d["const"].attr.name,a+"@Delete")):(this.$input.removeAttr(d["const"].attr.name),this.$typeHint.removeAttr(d["const"].attr.name),this.$deleteHint.removeAttr(d["const"].attr.name))},isValid:function(){return!0},getValue:function(){return this.$input.prop("checked")},setValue:function(a){this.$input.prop("checked","false"==a?!1:a)},reset:function(){this.$input.prop("checked",!1)}});d.register(".widget.checkbox-widget",c.CheckboxWidget);c.SelectButtonsWidget=d.Widget.extend({initialize:function(a){d.Widget.prototype.initialize.apply(this,
[a]);this.$(".btn").click(_.bind(this.onSelect,this))},onSelect:function(a){a.preventDefault();this.setValue($(a.currentTarget).attr("data-value"),!0);return!1},getValue:function(){return this.value=this.$(".active").attr("data-value")},setValue:function(a,b){this.$(".btn").removeClass("active");this.$('.btn[data-value="'+a+'"]').addClass("active");this.value=this.$(".active").attr("data-value");b&&this.$el.trigger("change")}});d.register(".widget.select-buttons-widget",c.SelectButtonsWidget);c.RadioGroupWidget=
d.Widget.extend({getCount:function(){return this.$('input[type="radio"]').length},getOnlyOne:function(){return 1==this.getCount()?this.$('input[type="radio"]').val():void 0},getValue:function(){return this.value=this.$('input[type="radio"]:checked').val()},setValue:function(a,b){this.$('input[type="radio"][value="'+a+'"]').prop("checked",!0);this.getValue();b&&this.$el.trigger("change")},reset:function(){this.value=this.$('input[type="radio"]:checked').removeAttr("checked")}});d.register(".widget.radio-group-widget",
c.RadioGroupWidget);c.SelectWidget=d.Widget.extend({retrieveInput:function(){return this.$el.is("select")?this.$el:this.$("select")},getValue:function(){return this.$el.val()},setValue:function(a,b){this.$el.val(a);b&&this.$el.trigger("change")},reset:function(){this.$el.selectedIndex=-1},setOptions:function(a){this.$el.html("");_.isArray(a)&&a.forEach(function(a){_.isObject(a)?this.$input.append('<option value="'+(a.value||a.key)+'">'+(a.label||a.name)+"</option>"):this.$input.append("<option>"+
a+"</option>")},this)}});d.register(".widget.select-widget",c.SelectWidget);c.TextFieldWidget=d.Widget.extend({initialize:function(a){d.Widget.prototype.initialize.apply(this,[a]);this.$textField=this.textField();this.initRules(this.$textField);this.rules&&(this.$textField.on("keyup.validate",_.bind(this.validate,this)),this.$textField.on("change.validate",_.bind(this.validate,this)))},getValue:function(){return this.$textField.val()},setValue:function(a,b){""+this.$textField.val()!=""+a&&(this.$textField.val(a),
b&&this.$textField.trigger("change"))},focus:function(){this.$textField.focus()},selectAll:function(){this.$textField.select()},textField:function(){return this.$el.is("input")?this.$el:this.$("input")},validate:function(a){this.valid=!0;if(!this.$el.hasClass("hidden")&&this.$textField.prop("name")){var b=this.getValue();if(this.rules){if(this.rules.mandatory){var c=this.valid=void 0!==b&&(this.rules.blank||0<b.trim().length);c||this.alert(a,"danger","","value is mandatory")}this.valid&&this.rules.pattern&&
((c=this.valid=this.rules.blank&&(!b||1>b.trim().length)||this.rules.pattern.test(b))||this.alert(a,"danger","",this.rules.patternHint||"value doesn't match pattern",this.rules.pattern))}this.valid&&_.isFunction(this.extValidate)&&(this.valid=this.extValidate(b));this.valid?this.$textField.closest(".form-group").removeClass("has-error"):this.$textField.closest(".form-group").addClass("has-error")}return this.valid},reset:function(){this.valid=void 0;this.$textField.closest(".form-group").removeClass("has-error");
this.$textField.val(void 0)}});d.register(".widget.text-field-widget",c.TextFieldWidget);c.TextAreaWidget=d.Widget.extend({initialize:function(a){d.Widget.prototype.initialize.apply(this,[a]);this.initRules(this.$input);this.rules&&(this.$input.on("keyup.validate",_.bind(this.validate,this)),this.$input.on("change.validate",_.bind(this.validate,this)))},retrieveInput:function(){return this.$el.is("textarea")?this.$el:this.$("textarea")},getValue:function(){return this.$input[0].value},setValue:function(a,
b){""+this.$input.text()!=""+a&&(this.$input[0].value=a,b&&this.$input.trigger("change"))},focus:function(){this.$input.focus()},selectAll:function(){this.$input.select()},validate:function(){this.valid=!0;if(!this.$el.hasClass("hidden")&&this.$input.prop("name")){var a=this.getValue();this.rules&&this.rules.mandatory&&(this.valid=void 0!==a&&(this.rules.blank||0<a.trim().length));this.valid&&_.isFunction(this.extValidate)&&(this.valid=this.extValidate(a));this.valid?this.$input.closest(".form-group").removeClass("has-error"):
this.$input.closest(".form-group").addClass("has-error")}return this.valid},reset:function(){this.valid=void 0;this.$input.closest(".form-group").removeClass("has-error");this.$input.text("")}});d.register(".widget.text-area-widget",c.TextAreaWidget);c.PathWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);this.dialogTitle=this.$el.attr("title");this.dialogLabel=this.$el.data("label");this.rootPath=this.$el.data("root")||"/";this.filter=
this.$el.data("filter");this.$textField.attr("autocomplete","off");this.$textField.typeahead({minLength:1,source:function(a,c){0===a.indexOf("/")&&e.getJson("/bin/cpm/nodes/node.typeahead.json"+a,function(a){c(a)})},matcher:function(a){var b=/^(.*\/)([^\/]*)$/.exec(this.query);return a.match(".*"+b[2]+".*")},highlighter:function(a){var b=/^(.*\/)([^\/]*)$/.exec(this.query);a=(new RegExp("^(.*)"+b[2]+"(.*)?")).exec(a);return a[1]+"<b>"+b[2]+"</b>"+(a[2]||"")}});this.$selectButton=this.$("button.select");
if(0<this.$selectButton.length)this.$selectButton.on("click",_.bind(this.selectPath,this))},selectPath:function(a){var b=e.getView("#path-select-dialog",c.SelectPathDialog);b.setTitle(this.dialogTitle);b.setLabel(this.dialogLabel);b.setRootPath(this.rootPath);b.setFilter(this.filter);b.show(_.bind(function(){this.getPath(_.bind(b.setValue,b))},this),_.bind(function(){this.setPath(b.getValue())},this))},getPath:function(a){a(this.getValue())},setPath:function(a){this.setValue(a)}});d.register(".widget.path-widget",
c.PathWidget);c.ReferenceWidget=c.PathWidget.extend({initialize:function(a){c.PathWidget.prototype.initialize.apply(this,[a]);this.filter||(this.filter="referenceable")},getPath:function(a){this.path?a(this.path):this.retrievePath(_.bind(function(b){this.path=b;a(b)},this))},setPath:function(a){this.path=void 0;this.retrieveReference(a)},retrieveReference:function(a){e.getJson("/bin/cpm/nodes/node.tree.json"+a,_.bind(function(b){this.path=a;this.setValue(b.uuid?b.uuid:b.id)},this))},retrievePath:function(a){var b=
this.getValue();b&&e.getJson("/bin/cpm/nodes/node.reference.json/"+b,function(b){a(b.path)})}});d.register(".widget.reference-widget",c.ReferenceWidget);c.NumberFieldWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);var b=this.$el.data("options");b&&(b=b.split(":"),0<b.length&&(a.minValue=b[0]),1<b.length&&(a.stepSize=b[1]),2<b.length&&(a.maxValue=b[2]));this.minValue=Number(a.minValue||0);this.stepSize=Number(a.stepSize||1);this.maxValue=
a.maxValue?Number(a.maxValue):void 0;this.$(".increment").click(_.bind(this.increment,this));this.$(".decrement").click(_.bind(this.decrement,this));this.$textField.on("change.number",_.bind(this.onChange,this))},setValue:function(a,b){if(a){var d=Number(a);void 0!==this.minValue&&d<this.minValue&&(a=this.minValue);void 0!==this.maxValue&&d>this.maxValue&&(a=this.maxValue)}c.TextFieldWidget.prototype.setValue.apply(this,[a,b])},onChange:function(){this.setValue(this.getValue())},increment:function(){this.stepSize&&
this.setValue(parseInt(this.getValue())+this.stepSize,!0)},decrement:function(){this.stepSize&&this.setValue(parseInt(this.getValue())-this.stepSize,!0)},extValidate:function(a){var b=!0;b&&void 0!==this.minValue&&(b=a>=this.minValue);b&&void 0!==this.maxValue&&(b=a<=this.maxValue);return b}});d.register(".widget.number-field-widget",c.NumberFieldWidget);c.DateTimeWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);this.$el.datetimepicker({locale:"en",
format:"YYYY-MM-DD HH:mm:ss",extraFormats:"YY-MM-DD;YY-MM-DD HH:mm;YY-MM-DD HH:mm ZZ;YY-MM-DD HH:mm:ss;YY-MM-DD HH:mm:ss ZZ;YYYY-MM-DD;YYYY-MM-DD HH:mm;YYYY-MM-DD HH:mm ZZ;YYYY-MM-DD HH:mm:ss;YYYY-MM-DD HH:mm:ss ZZ;DD.MM.YY;DD.MM.YY HH:mm;DD.MM.YY HH:mm ZZ;DD.MM.YY HH:mm:ss;DD.MM.YY HH:mm:ss ZZ;DD.MM.YYYY;DD.MM.YYYY HH:mm;DD.MM.YYYY HH:mm ZZ;DD.MM.YYYY HH:mm:ss;DD.MM.YYYY HH:mm:ss ZZ".split(";"),calendarWeeks:!0,showTodayButton:!0,showClear:!0,showClose:!0})},setValue:function(a,b){this.$el.data("DateTimePicker").date(a?
new Date(a):void 0);this.validate();b&&this.$el.trigger("change")}});d.register(".widget.date-time-widget",c.DateTimeWidget);c.FileUploadWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);var b=this.$el.data("options");b&&(0<=b.indexOf("hidePreview")&&(a.showPreview=!1,a.showUploadedThumbs=!1),0<=b.indexOf("showUpload")&&(a.showUpload=!0));if(b=this.$el.data("type"))a.fileType=b;this.whatever=this.$textField.fileinput({showPreview:void 0===
a.showPreview?!0:a.showPreview,showUpload:a.showUpload||!1,fileType:a.fileType||"any"});this.$widget=this.$el.closest(".file-input-new");this.$inputCaption=this.$widget.find(".kv-fileinput-caption")},setValue:function(a){},grabFocus:function(){this.$inputCaption.focus()},reset:function(){this.$textField.fileinput("clear")}});d.register(".widget.file-upload-widget",c.FileUploadWidget);c.PropertyNameWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,
[a]);this.$textField.typeahead({minLength:1,source:"jcr:data jcr:description jcr:lastModified jcr:lastModifiedBy jcr:mixinTypes jcr:primaryType jcr:title sling:redirect sling:resourceType".split(" ")})}});d.register(".widget.property-name-widget",c.PropertyNameWidget);c.RepositoryNameWidget=c.TextFieldWidget.extend({nameChanged:function(a,b){"jcr:primaryType"==a?b.setWidgetType.apply(b,["jcr-primaryType"]):"jcr:mixinTypes"==a&&b.setWidgetType.apply(b,["jcr-mixinTypes"])}});d.register(".widget.repository-name-widget",
c.RepositoryNameWidget);c.PrimaryTypeWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);this.$textField.attr("autocomplete","off");this.$textField.typeahead({minLength:1,source:function(a,c){e.ajaxGet("/bin/cpm/core/system.primaryTypes.json",{query:a},function(a){c(a)})}})}});d.register(".widget.primary-type-widget",c.PrimaryTypeWidget);c.MixinTypeWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,
[a]);this.$textField.attr("autocomplete","off");this.$textField.typeahead({minLength:1,source:function(a,c){e.ajaxGet("/bin/cpm/core/system.mixinTypes.json",{query:a},function(a){c(a)})}})}});d.register(".widget.mixin-type-widget",c.MixinTypeWidget)})(e.components,window.widgets)})(window.core);
