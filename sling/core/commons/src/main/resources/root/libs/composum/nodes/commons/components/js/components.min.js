(function(d){d.components=d.components||{};(function(c){c.FormWidget=Backbone.View.extend({isValid:function(){return this.validate()},validate:function(){var a=!0;this.$(".widget").each(function(){this.view&&_.isFunction(this.view.isValid)&&(a=this.view.isValid.apply(this.view)&&a)});a?(this.$el.removeClass("invalid-form"),this.$el.addClass("valid-form")):(this.$el.removeClass("valid-form"),this.$el.addClass("invalid-form"));return a},getValues:function(){var a={};this.$(".widget").each(function(){if(this.view&&
0==this.view.$el.parent().closest(".multi-form-item").length&&_.isFunction(this.view.getValue))for(var b=d.getWidgetName(this.view).split("."),c=a,e=0;e<b.length;e++)e<b.length-1?(c[b[e]]=c[b[e]]||{},c=c[b[e]]):c[b[e]]=this.view.getValue.apply(this.view)});return a},setValues:function(a){this.$(".widget").each(function(){if(this.view&&0==this.view.$el.parent().closest(".multi-form-item").length&&_.isFunction(this.view.setValue))for(var b=d.getWidgetName(this.view).split("."),c=a,e=0;e<b.length;e++)e<
b.length-1?c&&(c=c[b[e]]):this.view.setValue.apply(this.view,[c?c[b[e]]:void 0])})},reset:function(){this.$(".widget").each(function(){this.view&&_.isFunction(this.view.reset)&&this.view.reset.apply(this.view)})},submitForm:function(a,b,c){d.submitForm(this.el,a,b,c)},submitFormPut:function(a,b,c){d.submitFormPut(this.el,this.getValues(),a,b,c)}});c.CheckboxWidget=Backbone.View.extend({initialize:function(a){this.$checkkox=this.$el.is('input[type="checkbox"]')?this.$el:this.$('input[type="checkbox"]')},
isValid:function(){return!0},getValue:function(){return this.$checkkox.prop("checked")},setValue:function(a){this.$checkkox.prop("checked","false"==a?!1:a)},reset:function(){this.$checkkox.prop("checked",!1)}});c.SelectButtonsWidget=Backbone.View.extend({initialize:function(a){this.$(".btn").click(_.bind(this.onSelect,this))},onSelect:function(a){a.preventDefault();this.setValue($(a.currentTarget).attr("data-value"),!0);return!1},getValue:function(){return this.value=this.$(".active").attr("data-value")},
setValue:function(a,b){this.$(".btn").removeClass("active");this.$('.btn[data-value="'+a+'"]').addClass("active");this.value=this.$(".active").attr("data-value");b&&this.$el.trigger("change")}});c.RadioGroupWidget=Backbone.View.extend({getCount:function(){return this.$('input[type="radio"]').length},getOnlyOne:function(){return 1==this.getCount()?this.$('input[type="radio"]').val():void 0},getValue:function(){return this.value=this.$('input[type="radio"]:checked').val()},setValue:function(a,b){this.$('input[type="radio"][value="'+
a+'"]').prop("checked",!0);this.getValue();b&&this.$el.trigger("change")},reset:function(){this.value=this.$('input[type="radio"]:checked').removeAttr("checked")}});c.ComboBoxWidget=Backbone.View.extend({initialize:function(a){},getValue:function(){return this.$el.val()},setValue:function(a,b){this.$el.val(a);b&&this.$el.trigger("change")},reset:function(){this.$el.selectedIndex=-1}});c.TextFieldWidget=Backbone.View.extend({initialize:function(a){this.$textField=this.textField();if(a=this.$textField.attr("data-pattern"))0===
a.indexOf("/")?this.$textField.pattern=eval(a):this.$textField.pattern=new RegExp(a);if(a=this.$textField.attr("data-rules"))this.$textField.rules={mandatory:a.indexOf(!1)};if(this.$textField.pattern||this.$textField.rules)this.$textField.on("keyup.validate",_.bind(this.validate,this)),this.$textField.on("change.validate",_.bind(this.validate,this))},getValue:function(){return this.$textField.val()},setValue:function(a,b){""+this.$textField.val()!=""+a&&(this.$textField.val(a),b&&this.$textField.trigger("change"))},
focus:function(){this.$textField.focus()},selectAll:function(){this.$textField.select()},textField:function(){return this.$el.is("input")?this.$el:this.$("input")},isValid:function(){void 0===this.valid&&this.validate();return this.valid},validate:function(){this.valid=!0;if(!this.$el.hasClass("hidden")&&this.$textField.prop("name")){var a=this.getValue();this.$textField.rules&&this.$textField.rules.mandatory&&(this.valid=void 0!==a&&0<a.trim().length);this.valid&&this.$textField.pattern&&a&&0<a.trim().length&&
(this.valid=this.$textField.pattern.test(a));this.valid&&_.isFunction(this.extValidate)&&(this.valid=this.extValidate(a));this.valid?this.$textField.closest(".form-group").removeClass("has-error"):this.$textField.closest(".form-group").addClass("has-error")}return this.valid},reset:function(){this.valid=void 0;this.$textField.closest(".form-group").removeClass("has-error");this.$textField.val(void 0)}});c.TextAreaWidget=Backbone.View.extend({initialize:function(a){this.$textArea=this.textArea();if(a=
this.$textArea.attr("data-rules"))this.$textArea.rules={mandatory:a.indexOf(!1)};this.$textArea.rules&&(this.$textArea.on("keyup.validate",_.bind(this.validate,this)),this.$textArea.on("change.validate",_.bind(this.validate,this)))},getValue:function(){return this.$textArea[0].value},setValue:function(a,b){""+this.$textArea.text()!=""+a&&(this.$textArea[0].value=a,b&&this.$textArea.trigger("change"))},focus:function(){this.$textArea.focus()},selectAll:function(){this.$textArea.select()},textArea:function(){return this.$el.is("textarea")?
this.$el:this.$("textarea")},isValid:function(){void 0===this.valid&&this.validate();return this.valid},validate:function(){this.valid=!0;if(!this.$el.hasClass("hidden")&&this.$textArea.prop("name")){var a=this.getValue();this.$textArea.rules&&this.$textArea.rules.mandatory&&(this.valid=void 0!==a&&0<a.trim().length);this.valid&&_.isFunction(this.extValidate)&&(this.valid=this.extValidate(a));this.valid?this.$textArea.closest(".form-group").removeClass("has-error"):this.$textArea.closest(".form-group").addClass("has-error")}return this.valid},
reset:function(){this.valid=void 0;this.$textArea.closest(".form-group").removeClass("has-error");this.$textArea.text("")}});c.PathWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);this.dialogTitle=this.$el.attr("title");this.dialogLabel=this.$el.data("label");this.rootPath=this.$el.data("root")||"/";this.filter=this.$el.data("filter");this.$textField.attr("autocomplete","off");this.$textField.typeahead({minLength:1,source:function(a,c){0===
a.indexOf("/")&&d.getJson("/bin/cpm/nodes/node.typeahead.json"+a,function(a){c(a)})},matcher:function(a){var b=/^(.*\/)([^\/]*)$/.exec(this.query);return a.match(".*"+b[2]+".*")},highlighter:function(a){var b=/^(.*\/)([^\/]*)$/.exec(this.query);a=(new RegExp("^(.*)"+b[2]+"(.*)?")).exec(a);return a[1]+"<b>"+b[2]+"</b>"+(a[2]||"")}});this.$selectButton=this.$("button.select");if(0<this.$selectButton.length)this.$selectButton.on("click",_.bind(this.selectPath,this))},selectPath:function(a){var b=d.getView("#path-select-dialog",
c.SelectPathDialog);b.setTitle(this.dialogTitle);b.setLabel(this.dialogLabel);b.setRootPath(this.rootPath);b.setFilter(this.filter);b.show(_.bind(function(){this.getPath(_.bind(b.setValue,b))},this),_.bind(function(){this.setPath(b.getValue())},this))},getPath:function(a){a(this.getValue())},setPath:function(a){this.setValue(a)}});c.ReferenceWidget=c.PathWidget.extend({initialize:function(a){c.PathWidget.prototype.initialize.apply(this,[a]);this.filter||(this.filter="referenceable")},getPath:function(a){this.path?
a(this.path):this.retrievePath(_.bind(function(b){this.path=b;a(b)},this))},setPath:function(a){this.path=void 0;this.retrieveReference(a)},retrieveReference:function(a){d.getJson("/bin/cpm/nodes/node.tree.json"+a,_.bind(function(b){this.path=a;this.setValue(b.uuid?b.uuid:b.id)},this))},retrievePath:function(a){var b=this.getValue();b&&d.getJson("/bin/cpm/nodes/node.reference.json/"+b,function(b){a(b.path)})}});c.NumberFieldWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,
[a]);var b=this.$el.data("options");b&&(b=b.split(":"),0<b.length&&(a.minValue=b[0]),1<b.length&&(a.stepSize=b[1]),2<b.length&&(a.maxValue=b[2]));this.minValue=Number(a.minValue||0);this.stepSize=Number(a.stepSize||1);this.maxValue=a.maxValue?Number(a.maxValue):void 0;this.$(".increment").click(_.bind(this.increment,this));this.$(".decrement").click(_.bind(this.decrement,this));this.$textField.on("change.number",_.bind(this.onChange,this))},setValue:function(a,b){if(a){var d=Number(a);void 0!==this.minValue&&
d<this.minValue&&(a=this.minValue);void 0!==this.maxValue&&d>this.maxValue&&(a=this.maxValue)}c.TextFieldWidget.prototype.setValue.apply(this,[a,b])},onChange:function(){this.setValue(this.getValue())},increment:function(){this.stepSize&&this.setValue(parseInt(this.getValue())+this.stepSize,!0)},decrement:function(){this.stepSize&&this.setValue(parseInt(this.getValue())-this.stepSize,!0)},extValidate:function(a){var b=!0;b&&void 0!==this.minValue&&(b=a>=this.minValue);b&&void 0!==this.maxValue&&(b=
a<=this.maxValue);return b}});c.DateTimeWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);this.$el.datetimepicker({locale:"en",format:"YYYY-MM-DD HH:mm:ss",extraFormats:"YY-MM-DD;YY-MM-DD HH:mm;YY-MM-DD HH:mm ZZ;YY-MM-DD HH:mm:ss;YY-MM-DD HH:mm:ss ZZ;YYYY-MM-DD;YYYY-MM-DD HH:mm;YYYY-MM-DD HH:mm ZZ;YYYY-MM-DD HH:mm:ss;YYYY-MM-DD HH:mm:ss ZZ;DD.MM.YY;DD.MM.YY HH:mm;DD.MM.YY HH:mm ZZ;DD.MM.YY HH:mm:ss;DD.MM.YY HH:mm:ss ZZ;DD.MM.YYYY;DD.MM.YYYY HH:mm;DD.MM.YYYY HH:mm ZZ;DD.MM.YYYY HH:mm:ss;DD.MM.YYYY HH:mm:ss ZZ".split(";"),
calendarWeeks:!0,showTodayButton:!0,showClear:!0,showClose:!0})},setValue:function(a,b){this.$el.data("DateTimePicker").date(a?new Date(a):void 0);this.validate();b&&this.$el.trigger("change")}});c.FileUploadWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);var b=this.$el.data("options");b&&(0<=b.indexOf("hidePreview")&&(a.showPreview=!1,a.showUploadedThumbs=!1),0<=b.indexOf("showUpload")&&(a.showUpload=!0));if(b=this.$el.data("type"))a.fileType=
b;this.$textField.fileinput({showPreview:void 0===a.showPreview?!0:a.showPreview,showUpload:a.showUpload||!1,fileType:a.fileType||"any"})},setValue:function(a){}});c.PropertyNameWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);this.$textField.typeahead({minLength:1,source:"jcr:data jcr:description jcr:lastModified jcr:lastModifiedBy jcr:mixinTypes jcr:primaryType jcr:title sling:redirect sling:resourceType".split(" ")})}});c.RepositoryNameWidget=
c.TextFieldWidget.extend({nameChanged:function(a,b){"jcr:primaryType"==a?b.setWidgetType.apply(b,["jcr-primaryType"]):"jcr:mixinTypes"==a&&b.setWidgetType.apply(b,["jcr-mixinTypes"])}});c.PrimaryTypeWidget=c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);this.$textField.attr("autocomplete","off");this.$textField.typeahead({minLength:1,source:function(a,c){d.ajaxGet("/bin/cpm/core/system.primaryTypes.json",{query:a},function(a){c(a)})}})}});c.MixinTypeWidget=
c.TextFieldWidget.extend({initialize:function(a){c.TextFieldWidget.prototype.initialize.apply(this,[a]);this.$textField.attr("autocomplete","off");this.$textField.typeahead({minLength:1,source:function(a,c){d.ajaxGet("/bin/cpm/core/system.mixinTypes.json",{query:a},function(a){c(a)})}})}})})(d.components)})(window.core);
