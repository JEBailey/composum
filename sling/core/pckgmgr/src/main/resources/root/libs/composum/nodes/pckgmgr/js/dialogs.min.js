(function(a){a.pckgmgr=a.pckgmgr||{};(function(c){c.getCreatePackageDialog=function(){return a.getView("#pckg-create-dialog",c.CreatePackageDialog)};c.getDeletePackageDialog=function(){return a.getView("#pckg-delete-dialog",c.DeletePackageDialog)};c.getUploadPackageDialog=function(){return a.getView("#pckg-upload-dialog",c.UploadPackageDialog)};c.CreatePackageDialog=a.components.Dialog.extend({initialize:function(b){a.components.Dialog.prototype.initialize.apply(this,[b]);this.form=a.getWidget(this.el,
"form.widget-form",a.components.FormWidget);this.$group=this.$('input[name="group"]');this.$name=this.$('input[name="name"]');this.$version=this.$('input[name="version"]');this.$("button.create").click(_.bind(this.createPackage,this))},initGroup:function(a){this.$group.val(a)},createPackage:function(b){b.preventDefault();this.form.isValid()?this.submitForm(function(b){b=b.path;var c=a.getParentPath(b),f=a.getNameFromPath(b);$(document).trigger("path:inserted",[c,f]);$(document).trigger("path:select",
[b])}):this.alert("danger","a name must be specified");return!1}});c.DeletePackageDialog=a.components.Dialog.extend({initialize:function(b){a.components.Dialog.prototype.initialize.apply(this,[b]);this.form=a.getWidget(this.el,"form.widget-form",a.components.FormWidget);this.$group=this.$('input[name="group"]');this.$name=this.$('input[name="name"]');this.$version=this.$('input[name="version"]');this.$("button.delete").click(_.bind(this.deletePackage,this))},setPackage:function(a){a?(this.$group.val(a.group),
this.$name.val(a.name),this.$version.val(a.version)):(this.$group.val(void 0),this.$name.val(void 0),this.$version.val(void 0))},deletePackage:function(b){b.preventDefault();b=this.$group.val();var c=this.$name.val(),e=this.$version.val(),d="/"+(b?b+"/":"")+c+(e?"-"+e:"")+".zip";this.form.isValid()?a.ajaxDelete("/bin/cpm/package.json"+a.encodePath(d),{},_.bind(function(a){$(document).trigger("path:deleted",[d]);this.hide()},this),_.bind(function(a){this.alert("danger","Error on delete Package",a)},
this)):this.alert("danger","a valid Package must be specified");return!1}});c.UploadPackageDialog=a.components.Dialog.extend({initialize:function(b){a.components.Dialog.prototype.initialize.apply(this,[b]);this.form=a.getWidget(this.el,"form.widget-form",a.components.FormWidget);this.$file=this.$('input[name="file"]');this.$file.on("change.file",_.bind(this.fileChanged,this));this.$("button.upload").click(_.bind(this.uploadPackage,this))},initDialog:function(a,c){},uploadPackage:function(b){b.preventDefault();
this.form.isValid()?this.submitForm(function(b){b=b.path;var c=a.getParentPath(b),d=a.getNameFromPath(b);$(document).trigger("path:inserted",[c,d]);$(document).trigger("path:select",[b])}):this.alert("danger","a file must be specified");return!1},fileChanged:function(){}})})(a.pckgmgr)})(window.core);
