var $jscomp={scope:{},findInternal:function(b,c,a){b instanceof String&&(b=String(b));for(var d=b.length,e=0;e<d;e++){var f=b[e];if(c.call(a,f,e,b))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,a){if(a.get||a.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[c]=a.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,c,a,d){if(c){a=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var e=b[d];e in a||(a[e]={});a=a[e]}b=b[b.length-1];d=a[b];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6-impl","es3");
(function(b){b.pckgmgr=b.pckgmgr||{};(function(c){c.getUpdatePackageDialog=function(){return b.getView("#pckg-update-dialog",c.UpdatePackageDialog)};c.UpdatePackageDialog=b.components.Dialog.extend({initialize:function(a){b.components.Dialog.prototype.initialize.apply(this,[a]);this.form=b.getWidget(this.el,"form.widget-form",b.components.FormWidget);this.$path=this.$('input[name="path"]');this.$group=this.$('input[name="group"]');this.$name=this.$('input[name="name"]');this.$version=this.$('input[name="version"]');
this.$description=this.$('textarea[name="jcr:description"]');this.includeVersions=b.getWidget(this.el,'input[name="includeVersions"]',b.components.CheckboxWidget);this.$("button.save").click(_.bind(this.updatePackage,this))},initDialog:function(a){var d=c.getCurrentPath();a?(a.path&&(d=a.path),this.$group.val(a.group),this.$name.val(a.name),this.$version.val(a.version),this.includeVersions.setValue(a.includeVersions),this.$description.val(a.description)):(this.$group.val(void 0),this.$name.val(void 0),
this.$version.val(void 0),this.includeVersions.setValue(!1),this.$description.val(void 0));this.$path.val(d);this.form.$el.attr("action",b.getContextUrl("/bin/cpm/package.update.json"+d))},updatePackage:function(a){a.preventDefault();var b=this.$path.val();this.form.isValid()?this.submitForm(function(a){c.current.includeVersions=a["package"].definition.includeVersions;a=a.path;$(document).trigger("path:moved",[b,a]);$(document).trigger("path:changed",[a])}):this.alert("danger","a name must be specified");
return!1}});c.JcrPackageTab=b.console.JobControlTab.extend({jobTopic:"com/composum/sling/core/pckgmgr/PackageJobExecutor",purgeAuditKeep:6,initialize:function(a){b.console.JobControlTab.prototype.initialize.apply(this,[a]);this.$header=this.$(".package-detail .header-view");this.$default=this.$(".aspect-view .default-aspect");this.$feedback=this.$(".aspect-view .feedback-aspect");this.$title=this.$feedback.find(".title");this.$(".display-toolbar .edit").click(_.bind(this.editPackage,this));this.$(".display-toolbar .install").click(_.bind(this.installPackage,
this));this.$(".display-toolbar .assemble").click(_.bind(this.assemblePackage,this));this.$(".display-toolbar .uninstall").click(_.bind(this.uninstallPackage,this));this.$(".display-toolbar .upload").click(_.bind(c.treeActions.uploadPackage,c.treeActions));this.$(".display-toolbar .create").click(_.bind(c.treeActions.createPackage,c.treeActions));this.$(".display-toolbar .delete").click(_.bind(c.treeActions.deletePackage,c.treeActions));this.$(".display-toolbar .refresh").click(_.bind(this.refresh,
this));this.$feedback.find(".close").click(_.bind(this.closeFeedback,this));this.$logOutput=this.$feedback.find(".feedback-display .log-output");this.$auditLog=this.$(".audit-log");this.$auditList=this.$auditLog.find(".audit-list");this.$auditLog.find(".toolbar .refresh").click(_.bind(this.loadAuditLog,this));this.$auditLog.find(".toolbar .purge").click(_.bind(this.purgeAuditLog,this));$(document).on("path:changed",_.bind(this.refresh,this))},getCurrentPath:function(){return c.getCurrentPath()},editPackage:function(a){a&&
a.preventDefault();var b=c.getUpdatePackageDialog();b.show(_.bind(function(){b.initDialog({path:c.current.path,group:c.current.group,name:c.current.name,version:c.current.version,includeVersions:c.current.includeVersions,description:this.$(".package-detail .header-view .description").text()})},this))},startPackageOperation:function(a,c,e){a&&a.preventDefault();var d=b.console.getApprovalDialog();d.show(_.bind(function(){d.initDialog(c,'<div class="">'+this.getCurrentPath()+"</div>")},this),_.bind(function(){this.startJob({operation:e})},
this))},installPackage:function(a){this.startPackageOperation(a,"Install Package","install")},assemblePackage:function(a){this.startPackageOperation(a,"Build Package","assemble")},uninstallPackage:function(a){this.startPackageOperation(a,"Uninstall Package","uninstall")},refresh:function(a){a&&a.preventDefault();this.reload()},reload:function(){b.console.JobControlTab.prototype.reload.apply(this);b.ajaxGet(b.getContextUrl("/bin/packages.header.html"+c.getCurrentPath()),{},_.bind(function(a){this.$header.html(a)},
this));this.loadAuditLog()},jobStarted:function(a){b.console.JobControlTab.prototype.jobStarted.apply(this,[a]);this.openFeedback()},jobStopped:function(){b.console.JobControlTab.prototype.jobStopped.apply(this);this.reload()},jobSucceeded:function(){this.jobStopped()},closeFeedback:function(a){a&&a.preventDefault();this.$feedback.addClass("hidden");this.$default.removeClass("hidden");this.resetAuditLog()},openFeedback:function(a){a&&a.preventDefault();this.$default.addClass("hidden");this.$feedback.removeClass("hidden")},
loadAuditLogfile:function(a){this.openFeedback();b.console.JobControlTab.prototype.loadAuditLogfile.apply(this,[a])}})})(b.pckgmgr)})(window.core);
